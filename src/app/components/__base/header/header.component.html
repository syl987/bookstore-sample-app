<mat-toolbar class="mat-level2">
  <mat-toolbar-row class="gap-1 sm:gap-2">
    @if (!large()) {
      <button mat-icon-button (click)="sidenavToggle.emit()" class="-ms-2 sm:me-1 md:me-2" aria-label="Toggle Navigation" i18n-aria-label>
        <mat-icon>menu</mat-icon>
      </button>
    }
    @if (large() || !searchOpen()) {
      <div class="text-primary truncate text-base sm:text-lg md:text-xl">{{ options.applicationName }}</div>
    }
    @if (large()) {
      <nav mat-tab-nav-bar [tabPanel]="tabPanel" class="ms-2">
        @for (link of publicLinks; track link.path) {
          <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
        }
      </nav>
    }
    @if (large() || searchOpen()) {
      <form [formGroup]="form" (ngSubmit)="search(); searchOpen.set(false); form.controls.query.setValue('')" class="grow">
        <mat-form-field appearance="fill" class="w-16 min-w-full">
          @if (searching()) {
            <mat-spinner diameter="24" class="mx-3" matPrefix />
          } @else {
            <mat-icon class="text-primary align-top" matPrefix>search</mat-icon>
          }
          <input matInput formControlName="query" placeholder="Search..." aria-label="Search" appAutofocus i18n-placeholder i18n-aria-label />
        </mat-form-field>
      </form>
    }
    <span class="ms-2 me-auto"></span>

    @if (large()) {
      @if (user(); as user) {
        <div mat-tab-nav-bar [tabPanel]="tabPanel">
          <button mat-tab-link (click)="openUserSessionInfoDialog(user)" class="px-3">
            <app-header-user-info [user]="user" />
          </button>
        </div>

        <mat-divider vertical class="h-8" />

        <nav mat-tab-nav-bar [tabPanel]="tabPanel">
          @for (link of userLinks; track link.path) {
            <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
          }
          <button mat-tab-link (click)="logout()" class="px-3" i18n>Logout</button>
        </nav>
      } @else {
        <nav mat-tab-nav-bar [tabPanel]="tabPanel">
          <a mat-tab-link routerLink="/login" routerLinkActive [active]="a.isActive" class="px-3" i18n #a="routerLinkActive">Login</a>
        </nav>
      }
    } @else {
      <button mat-icon-button (click)="searchOpen.set(!searchOpen())" aria-label="Search" i18n-aria-label>
        @if (!searchOpen()) {
          <mat-icon>search</mat-icon>
        } @else {
          <mat-icon>close</mat-icon>
        }
      </button>
    }
    <mat-divider vertical class="h-8" />

    <button mat-icon-button (click)="themeService.toggleTheme()" aria-label="Toggle Theme">
      @if (themeService.theme === 'dark') {
        <mat-icon>dark_mode</mat-icon>
      } @else {
        <mat-icon>light_mode</mat-icon>
      }
    </button>

    <button mat-icon-button [matMenuTriggerFor]="languageMenu" class="-me-2" aria-label="Language" i18n-aria-label>
      <mat-icon fontSet="fp" [fontIcon]="currentLang.icon" />
    </button>
  </mat-toolbar-row>
</mat-toolbar>

<mat-menu xPosition="before" #languageMenu="matMenu">
  @for (language of languages; track language.locale) {
    <a mat-menu-item [attr.href]="'/' + language.locale">
      <mat-icon fontSet="fp" [fontIcon]="language.icon" />
      {{ language.label }}
    </a>
  }
</mat-menu>

<!-- TODO kick after fixed - workaround: tabs falsely require a tabPanel input -->
<mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>
