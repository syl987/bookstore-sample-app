<mat-toolbar class="mat-elevation-z2">
  <mat-toolbar-row cdkOverlayOrigin #searchOverlayTrigger="cdkOverlayOrigin">
    @if (desktop()) {
      <div class="text-primary me-4 text-lg">{{ options.applicationName }}</div>

      <nav mat-tab-nav-bar>
        @for (link of publicLinks; track link.path) {
          <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
        }
      </nav>

      <form [formGroup]="form" (ngSubmit)="search()">
        <mat-form-field appearance="fill" style="min-width: 268px">
          <mat-icon inline class="text-primary me-2 align-top" matTextPrefix>search</mat-icon>
          <input matInput formControlName="query" placeholder="Search..." aria-label="Search" i18n-placeholder i18n-aria-label />
          @if (searching()) {
            <mat-spinner diameter="24" class="me-4" matSuffix />
          }
        </mat-form-field>
      </form>

      <span class="ms-2 me-auto"></span>

      @if (user(); as user) {
        <div mat-tab-nav-bar>
          <button mat-tab-link (click)="openUserSessionInfoDialog(user)" class="px-3">
            <app-header-user-info [user]="user" />
          </button>
        </div>

        <mat-divider vertical class="mx-2" style="height: 32px" />

        <nav mat-tab-nav-bar>
          @for (link of userLinks; track link.path) {
            <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
          }
        </nav>

        <div mat-tab-nav-bar>
          <button mat-tab-link (click)="logout()" class="px-3" i18n>Logout</button>
        </div>
      } @else {
        <nav mat-tab-nav-bar>
          <a mat-tab-link routerLink="/login" routerLinkActive [active]="a.isActive" class="px-3" i18n #a="routerLinkActive">Login</a>
        </nav>
      }
      <mat-divider vertical class="mx-2" style="height: 32px" />
    } @else {
      <button mat-icon-button (click)="sidenavToggle.emit()" class="me-2" aria-label="Toggle Navigation" i18n-aria-label>
        <mat-icon>menu</mat-icon>
      </button>

      <div class="text-primary me-4 truncate text-base">{{ options.applicationName }}</div>

      <span class="ms-2 me-auto"></span>

      <button mat-icon-button (click)="searchOverlayOpen.set(!searchOverlayOpen())" aria-label="Search" i18n-aria-label>
        <mat-icon>search</mat-icon>
      </button>

      <ng-template
        cdkConnectedOverlay
        [cdkConnectedOverlayOpen]="searchOverlayOpen()"
        [cdkConnectedOverlayOrigin]="searchOverlayTrigger"
        [cdkConnectedOverlayPositions]="[{ originX: 'start', originY: 'top', overlayX: 'start', overlayY: 'top', panelClass: 'app-search-overlay' }]"
      >
        <form [formGroup]="form" (ngSubmit)="search(); searchOverlayOpen.set(false)" class="w-100">
          <mat-form-field appearance="fill" class="w-100">
            <mat-icon inline class="text-primary me-2 align-bottom" matTextPrefix>search</mat-icon>
            <input matInput formControlName="query" placeholder="Search..." aria-label="Search" i18n-placeholder i18n-aria-label />
            <button type="button" mat-icon-button (click)="searchOverlayOpen.set(false)" class="me-1" matSuffix>
              <mat-icon>close</mat-icon>
            </button>
          </mat-form-field>
        </form>
      </ng-template>
      <mat-divider vertical class="mx-2" style="height: 32px" />
    }
    <div class="flex gap-1">
      <button mat-icon-button (click)="themeService.toggleTheme()" aria-label="Toggle Theme">
        @if (themeService.theme === 'dark') {
          <mat-icon>dark_mode</mat-icon>
        } @else {
          <mat-icon>light_mode</mat-icon>
        }
      </button>

      <button mat-icon-button [matMenuTriggerFor]="languageMenu" aria-label="Language" i18n-aria-label>
        <mat-icon fontSet="fp" [fontIcon]="currentLang.icon" />
      </button>
    </div>
  </mat-toolbar-row>
</mat-toolbar>

<mat-menu xPosition="before" #languageMenu="matMenu">
  @for (language of languages; track language.locale) {
    <a mat-menu-item [attr.href]="'/' + language.locale">
      <mat-icon fontSet="fp" [fontIcon]="language.icon" />
      {{ language.label }}
    </a>
  }
</mat-menu>
