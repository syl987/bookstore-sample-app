<mat-toolbar class="mat-elevation-z2">
  <mat-toolbar-row cdkOverlayOrigin #searchOverlayTrigger="cdkOverlayOrigin">
    @if (desktop()) {
      <div class="text-primary me-4 text-xl">{{ options.applicationName }}</div>

      <nav mat-tab-nav-bar>
        @for (link of publicLinks; track link.path) {
          <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
        }
      </nav>

      <form [formGroup]="form" (ngSubmit)="search()">
        <mat-form-field appearance="fill" class="ms-2 min-w-3xs">
          @if (searching()) {
            <mat-spinner diameter="24" class="mx-3" matPrefix />
          } @else {
            <mat-icon class="text-primary align-top" matPrefix>search</mat-icon>
          }
          <input matInput formControlName="query" placeholder="Search..." aria-label="Search" i18n-placeholder i18n-aria-label />
        </mat-form-field>
      </form>

      <span class="ms-2 me-auto"></span>

      @if (user(); as user) {
        <div mat-tab-nav-bar>
          <button mat-tab-link (click)="openUserSessionInfoDialog(user)" class="px-3">
            <app-header-user-info [user]="user" />
          </button>
        </div>

        <mat-divider vertical class="mx-2 h-8" />

        <nav mat-tab-nav-bar>
          @for (link of userLinks; track link.path) {
            <a mat-tab-link [routerLink]="link.path" routerLinkActive [active]="a.isActive" class="px-3" #a="routerLinkActive">{{ link.label }}</a>
          }
        </nav>

        <div mat-tab-nav-bar>
          <button mat-tab-link (click)="logout()" class="px-3" i18n>Logout</button>
        </div>
      } @else {
        <nav mat-tab-nav-bar>
          <a mat-tab-link routerLink="/login" routerLinkActive [active]="a.isActive" class="px-3" i18n #a="routerLinkActive">Login</a>
        </nav>
      }
    } @else {
      <button mat-icon-button (click)="sidenavToggle.emit()" class="-ms-2 me-2" aria-label="Toggle Navigation" i18n-aria-label>
        <mat-icon>menu</mat-icon>
      </button>

      @if (!searchOpen()) {
        <div class="text-primary truncate text-base sm:text-lg md:text-xl">{{ options.applicationName }}</div>

        <span class="ms-2 me-auto"></span>
      } @else {
        <form [formGroup]="form" (ngSubmit)="search(); searchOpen.set(false); form.controls.query.setValue('')" class="grow">
          <mat-form-field appearance="fill" class="w-20 min-w-full">
            <input matInput formControlName="query" placeholder="Search..." aria-label="Search" appAutofocus i18n-placeholder i18n-aria-label />
          </mat-form-field>
        </form>
      }
      <button mat-icon-button (click)="searchOpen.set(!searchOpen())" aria-label="Search" i18n-aria-label>
        @if (!searchOpen()) {
          <mat-icon>search</mat-icon>
        } @else {
          <mat-icon>close</mat-icon>
        }
      </button>
    }
    <mat-divider vertical class="mx-2 h-8" />

    <div class="flex gap-1">
      <button mat-icon-button (click)="themeService.toggleTheme()" aria-label="Toggle Theme">
        @if (themeService.theme === 'dark') {
          <mat-icon>dark_mode</mat-icon>
        } @else {
          <mat-icon>light_mode</mat-icon>
        }
      </button>

      <button mat-icon-button [matMenuTriggerFor]="languageMenu" class="-me-2" aria-label="Language" i18n-aria-label>
        <mat-icon fontSet="fp" [fontIcon]="currentLang.icon" />
      </button>
    </div>
  </mat-toolbar-row>
</mat-toolbar>

<mat-menu xPosition="before" #languageMenu="matMenu">
  @for (language of languages; track language.locale) {
    <a mat-menu-item [attr.href]="'/' + language.locale">
      <mat-icon fontSet="fp" [fontIcon]="language.icon" />
      {{ language.label }}
    </a>
  }
</mat-menu>
